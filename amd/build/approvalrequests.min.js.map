{"version":3,"file":"approvalrequests.min.js","sources":["../src/approvalrequests.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function ($, Ajax, notification) {\n    return {\n        init: function () {\n            $(document).on('click', '.approve, .reject', function (e) {\n                e.preventDefault();\n                const REQUEST_ACCEPTED = 1;\n                const REQUEST_REJECTED = 3;\n                let userid = $(this).attr('id').split(':')[1];\n                let courseid = $(this).data('courseid');\n                let requestStatus = $(this).hasClass('approve');\n                let userdisplayname = $(this).data('username');\n                let notificationObject = {\n                    message: `User ${userdisplayname} request has been ${requestStatus ? 'approved' : 'rejected'}.`,\n                    type: 'info'\n                };\n                $('.table-responsive').addClass('process');\n                $('.loader_container').css('display', 'block');\n                Ajax.call([\n                    {\n                        methodname: 'enrol_approvalenrol_updaterequests',\n                        args: {\n                            userid: userid,\n                            courseid: courseid,\n                            requeststatus: requestStatus ? REQUEST_ACCEPTED : REQUEST_REJECTED\n                        },\n                        done: function (response) {\n                            if (response.statuscode == 200) {\n                                $('.table-responsive').removeClass('process');\n                                $('.loader_container').css('display', 'none');\n                                notification.addNotification(notificationObject);\n                                let tableBody = '';\n                                if (response.data.length == 0) {\n                                    tableBody = $(\"<div>\").append('No requests found').addClass('alert alert-info');\n                                    $('.generaltable').empty();\n                                    $('.generaltable').append(tableBody);\n                                } else {\n                                    let i = 1;\n                                    $.each(response.data, function (index, value) {\n                                        let lastrow = (index == response.data.length - 1);\n                                        const commonattr = {\n                                            'data-courseid': value.courseid,\n                                            'data-username': value.firstname + \" \" + value.lastname,\n                                        };\n\n                                        let approveIcon = $('<a>', {\n                                            href:`${M.cfg.wwwroot}/enrol/approvalenrol/approve.php?id=${value.id}&userid=${userid}\n                                            courseid=${courseid}&requeststatus=${REQUEST_ACCEPTED}`\n                                        }).append(\n                                            $('<img>', {\n                                                src: M.cfg.wwwroot + '/enrol/approvalenrol/pix/check-solid.svg',\n                                                class: 'icon approve',\n                                                id: 'approve-id:' + value.userid,\n                                            }).attr(commonattr)\n                                        );let rejectIcon = $('<a>', {\n                                            href: `${M.cfg.wwwroot}/enrol/approvalenrol/approve.php?id=${value.id}\n                                            &userid=${userid}&courseid=${courseid}&requeststatus=${REQUEST_REJECTED}`\n                                        }).append(\n                                            $('<img>', {\n                                                src: M.cfg.wwwroot + '/enrol/approvalenrol/pix/xmark-solid.svg',\n                                                class: 'icon reject',\n                                                id: 'reject-id:' + value.userid,\n                                            }).attr(commonattr)\n                                        );\n                                        tableBody += `\n                                        <tr class=\"${lastrow ? 'lastrow' : ''}\">\n                                            <td class=\"cell c0\">${i}</td>\n                                            <td class=\"cell c1\">${value.firstname + value.lastname}</td>\n                                            <td class=\"cell c2 \">${value.email}</td>\n                                            <td class=\"cell c3 lastcol\">\n                                            ${approveIcon.prop('outerHTML')} \n                                            ${rejectIcon.prop('outerHTML')}</td>\n                                        </tr>\n                                    `;\n                                        i++;\n                                    });\n                                }\n                                $('.generaltable tbody').empty();\n                                $('.generaltable tbody').append(tableBody);\n                            }\n                        },\n                        fail: function () {\n                        }\n                    }\n                ]);\n            });\n        }\n    };\n});"],"names":["define","$","Ajax","notification","init","document","on","e","preventDefault","userid","this","attr","split","courseid","data","requestStatus","hasClass","userdisplayname","notificationObject","message","type","addClass","css","call","methodname","args","requeststatus","done","response","statuscode","removeClass","addNotification","tableBody","length","append","empty","i","each","index","value","lastrow","commonattr","firstname","lastname","approveIcon","href","M","cfg","wwwroot","id","src","class","rejectIcon","email","prop","fail"],"mappings":"AAAAA,8CAAO,CAAC,SAAU,YAAa,sBAAsB,SAAUC,EAAGC,KAAMC,oBAC7D,CACHC,KAAM,WACFH,EAAEI,UAAUC,GAAG,QAAS,qBAAqB,SAAUC,GACnDA,EAAEC,qBAGEC,OAASR,EAAES,MAAMC,KAAK,MAAMC,MAAM,KAAK,GACvCC,SAAWZ,EAAES,MAAMI,KAAK,YACxBC,cAAgBd,EAAES,MAAMM,SAAS,WACjCC,gBAAkBhB,EAAES,MAAMI,KAAK,YAC/BI,mBAAqB,CACrBC,uBAAiBF,6CAAoCF,cAAgB,WAAa,gBAClFK,KAAM,QAEVnB,EAAE,qBAAqBoB,SAAS,WAChCpB,EAAE,qBAAqBqB,IAAI,UAAW,SACtCpB,KAAKqB,KAAK,CACN,CACIC,WAAY,qCACZC,KAAM,CACFhB,OAAQA,OACRI,SAAUA,SACVa,cAAeX,cAlBF,EACA,GAmBjBY,KAAM,SAAUC,aACe,KAAvBA,SAASC,WAAmB,CAC5B5B,EAAE,qBAAqB6B,YAAY,WACnC7B,EAAE,qBAAqBqB,IAAI,UAAW,QACtCnB,aAAa4B,gBAAgBb,wBACzBc,UAAY,MACY,GAAxBJ,SAASd,KAAKmB,OACdD,UAAY/B,EAAE,SAASiC,OAAO,qBAAqBb,SAAS,oBAC5DpB,EAAE,iBAAiBkC,QACnBlC,EAAE,iBAAiBiC,OAAOF,eACvB,KACCI,EAAI,EACRnC,EAAEoC,KAAKT,SAASd,MAAM,SAAUwB,MAAOC,WAC/BC,QAAWF,OAASV,SAASd,KAAKmB,OAAS,QACzCQ,WAAa,iBACEF,MAAM1B,yBACN0B,MAAMG,UAAY,IAAMH,MAAMI,cAG/CC,YAAc3C,EAAE,MAAO,CACvB4C,eAAQC,EAAEC,IAAIC,uDAA8CT,MAAMU,sBAAaxC,yEACpEI,mCAzCd,KA0CEqB,OACCjC,EAAE,QAAS,CACPiD,IAAKJ,EAAEC,IAAIC,QAAU,2CACrBG,MAAO,eACPF,GAAI,cAAgBV,MAAM9B,SAC3BE,KAAK8B,aACNW,WAAanD,EAAE,MAAO,CACxB4C,eAASC,EAAEC,IAAIC,uDAA8CT,MAAMU,oEACzDxC,4BAAmBI,mCAjDhC,KAkDEqB,OACCjC,EAAE,QAAS,CACPiD,IAAKJ,EAAEC,IAAIC,QAAU,2CACrBG,MAAO,cACPF,GAAI,aAAeV,MAAM9B,SAC1BE,KAAK8B,aAEZT,0EACaQ,QAAU,UAAY,kFACTJ,oFACAG,MAAMG,UAAYH,MAAMI,4FACvBJ,MAAMc,8IAE3BT,YAAYU,KAAK,uEACjBF,WAAWE,KAAK,2GAGtBlB,OAGRnC,EAAE,uBAAuBkC,QACzBlC,EAAE,uBAAuBiC,OAAOF,aAGxCuB,KAAM"}